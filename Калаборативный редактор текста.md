[прошлый ресёрч](https://docs.google.com/document/d/1Cvw2VW_agDllx-Mutqou8_aEUWHvlM1ytjPqxuXCz9Y/edit)
### Потенциальные проблемы:

1. Лагает рендер текста / долго пересчитывать изменения
2. Сокращение количества запросов для сохранения
3. Синхронизация и конфликты изменений от разных пользователей
4. Работа на мобильных браузерах, если они нужны
5. Поддержка истории изменений
### Как решает проблему draft.js:

1. Разбивает на чанки текст 
### Какие инструменты предоставляет draft.js:

1. Работа с текстом и его стилизацией, разметкой и тд
### Какие вопросы нас интересуют:

1. Нужны ли страницы или одна сплошная
	1. Если нужна пагинация, то варианты форматирования страниц, колонтитулы, ориентация страниц и тп 
2. В каком формате хранится разметка
3. Максимальное число участников в одном документе
	1. Max 50 редакторов одновременно
	2. Max 1000 наблюдателей
5. Максимальные размеры документов
7. Необходимость нетекстовых данных: картинки, таблицы, спецсимволы и математические символы
8. Необходимо ли разграничения прав и уровней доступа

### Какие есть варианты реализации редактора:

1. Canvas / svg (гугл док)
2. Использование либы draft.js / lexical / prosemirror
Про варианты реализации разметки:
1. Latex
2. HTML
3. MD
4. Xml
  
Ссылочки  
[How To Build A Google Docs Clone With React, Socket.io, and MongoDB](https://www.youtube.com/watch?v=iRaelG7v0OU)

[Mini Google Docs Clone in React - Intro](https://www.youtube.com/watch?v=CmuUQymjbRo&list=PLN3n1USn4xllb05dQVmRbVtGP2aM4seVq)

[https://youtube.com/playlist?list=PLcAVdtHk_JSRW_IpvEn_wWy0MVkSf1WYX&si=ARfz1aCz3o7eBPwA](https://youtube.com/playlist?list=PLcAVdtHk_JSRW_IpvEn_wWy0MVkSf1WYX&si=ARfz1aCz3o7eBPwA)

[https://www.youtube.com/watch?v=YCjVIDv0zQY](https://www.youtube.com/watch?v=YCjVIDv0zQY)

[NYT: Building a real-time collaborative editor with Firestore](https://www.youtube.com/watch?v=LEoWPdQh27c)


[https://docs.yjs.dev/api/faq#i-get-a-new-clientid-for-every-session-is-there-a-way-to-make-it-static-for-a-peer-accessing-the-document](https://docs.yjs.dev/api/faq#i-get-a-new-clientid-for-every-session-is-there-a-way-to-make-it-static-for-a-peer-accessing-the-document)

  

  

# Механизм синхронизации 
 ## CRDT
Нам не обязательно но крайне желательно. Вводит на все изменение документа частичный порядок и коммутативность чтобы время в которое мы получили изменение не влияло на финальный результат.  Можно грубо представить как "у каждого изменения будет временная метка и мы будем хранить все изменения а результат получать в качестве суммы всех изменений".
CRDT гарантирует, что последовательность изменений не повлияет на конечное состояние документа, подобно тому, как Git работает с коммитами..   
## y.js
Клиент-серверное приложение. Простая реализация CRDT. y-websocket реализует взаимодействие c сервером
Есть не очень популярная версия на [py](https://github.com/y-crdt/ypy?tab=readme-ov-file) которая оболочка над rust

[https://stackblitz.com/github/facebook/lexical/tree/fix/collab_example/examples/react-rich-collab?file=src%2FApp.tsx](https://stackblitz.com/github/facebook/lexical/tree/fix/collab_example/examples/react-rich-collab?file=src%2FApp.tsx)

# UI Библиотеки

Мы делаем WYSIWYG — расшифровывается как What You See Is What You Get, «Что видишь, то и получаешь» таком редакторе содержание отображается в процессе редактирования и выглядит максимально близко похожим на конечную верстку, которую увидит конечный пользователь. Это очень удобно, если редактор не особо владеет возможностями HTML и CSS. В большинстве случаев те кто пользуются такими редакторами привыкли к MS Word или Google-документы.
## DraftJs
`+++`
+ довольно гибкое API
+ Довольно продолжительное время для React-разработчиков это де-факто был стандарт для создания WYSIWYG
`---`
+ Использование immutable, что в 2024 году уже смотрится устаревше.  
+ Последняя публикация была четыре года назад и библиотека больше не сопровождается и не развивается.
---
## Lexical
[https://lexical.dev/](https://lexical.dev/)
 вопросы:
 + Как работать с dom lexical?
`+++`
+ Не лагает на 8000 строк на mac. Проверено на романе Война и мир.  Производительность упирается в основном в устройство и форматирование.
+ Встроенный коллаборативный режим. Для разруливания конфликтов можно использовать Yjs, реализующая CRDT.
+ Предоставляет низкого уровня фраемворк для реализации ui коллаборативных редакторов текста
+ Расширяем за счёт написания своих плагинов
+ Каждый стиль реализуется пользователем, максимально кастомизируем
+ Есть возможность создавать свои узлы в dom текста(картики, видео и т.д.)    [пример](https://codesandbox.io/p/sandbox/lexical-image-plugin-example-iy2bc5?file=%2Fsrc%2Fnodes%2FImageNode.tsx)
+ есть react обёртка 
+ Поддерживается md для разметки через плагин
+ ~~продукт компании meta как и сам react~~
`---`
+ Придётся самим прописывать все стили для каждого элемента
+ Придётся самим писать Toolbar
+ Нет поддержки LaTex плагином. Придётся писать самим если надо
---
## ProseMirror
[https://prosemirror.net/](https://prosemirror.net/)

Вопросы:
+ 
Встроенный коллаборативный режим. Для разруливания конфликтов используется Operational transformation, Y.js
`+++`
+ Очень низкий уровень абстракции по сравнению с Lexical
+ [react обёртка](https://bangle.dev/docs/examples/markdown-editor) не очень популярна и сделана другой командой
`---`
+ Крайне сложная для понимания библиотека. Заставляет вникать в детали реализации обязывая писать обёртку на себя прям в доке

## Tiptap

`+++`
+ Хорошая понятная документация
`---`
+ Непонятно как передавать Y.js doc по websocket 


# Уточнения 
1. Какие есть ещё библиотеки для crdt
2. Почему OT это долго и сложно(можно скинуть ссылку на статью)
3. Есть ли готовые решения по OT и если нет как реализовать OT c лексикалом


## Новые вопросы
**Будет ли работать быстрее без реакта на quill?**
Нет 
**Будет ли лагать без коллабортивности?**
Нет 
**Какая максимальная длина гугл дока?**




как тестируем 
#### Как стартануть
obs с fps cmnd+shift+p "Show frames"
#### Не забыть сказать 
1. Прочитайте задачу
2. Действует цензура
```
Задача:
По команде начинаем писать текст каждый в своем параграфе. Формат такой
	ФИО: Рассказ о себе или книгe, фильмe, кино, авторe, как проведу новый год или любая другая тема на которую можете экспромтом писать пару минут.
```


Тестовый текст
```
Тестов Тест Тестович Тестирую тест на тесте под тестом тестовый тест для теста я в своем познании на столько

  

  

  

Руслан: сайт ужас

  

  

ЛарисаЛариса

Я ппривет

А

По команде начинаем писать текст каждый в своем параграфе. Формат такой

ФИО: Рассказ о себе или книгe, фильмe, кино, авторe, как проведу новый год или л

Кондратова Ксения Владимировна. Сижу и пью кофе, сейчас пойду есть. На сегодня все, хватит

Васильев Дмитрий Олегович люблю отдыхать в зале жать 200 кг делаю классные пет проекты делаю проекты много проектов спасибо пожалуйста тест тестирование тесто тестов тест тест тест тест тест тест тесттест тест тесттесттест

Плетнева Анна Викторовна: Книги о Гарри Поттере очень интересно читать в подростковом возрасте. В свои 14 лет я прочитала все книги на одном дыхании и мне очень понравилось. в целом книги помогают уйти в свой мир, что-то обдумать, отдохнуть. книги - это классно

Аркадий Паровозов Паровозович:

Хочу стать большим-большим качком, люблю печеньки, печеньки с молочком. Принял с утра тестестерон, принял на бицепс, на бицепс пару тонн. Похавал гречку с творожком. Я не люблю ваш рацион. Сосиски плюс мазик – вот это еда. В KFC я затарюсь, вот это еда.

Руслан: это я. жава привет

Мария: Люблю фильмы, книги, сериалы, разные

Любимый фильм про прикючения: Хоббит

Люблю гулять по горам

редактируем документ большим количеством людей одновременно

все хорошо работает, редактируем, редактируем, редактируем.

123958666776767588585

тест ТЕСТ !"№;%:(?*() Test

  

Второв Никита Сергеевич: люблю настолки. Люблю писать в текстовые редакторы текст, который меня попросили написать в текстовом редакторе. Вообще-то не очень люблю, но тут просили. А почему попросили? А никто и не знает. Что еще писать непонятно. Вот бы сюда какую-нибудь чатджипити, а. Она бы написала целую историю. Сверху люди еще что-то пишут, и снизу. А мне грустно, я не умею столько писать. Надеюсь экран записывают со звуком. МАМА Я В ТЕЛЕВИЗОРЕ.

Жавохирбек Хайтибаев. Всем привет! Мне 22 года. Что я вам хочу сказать? Я люблю своб работу и сейчас скажу почему я не писал этого

почему

Однажды Эрнест Хемменгуэй сказал: Тихий океан знаешь? я успокоил  

Игитов Иван: Зубенко Михаил Петрович по кличке мафиозник в в в ввууцууцуу

  

Наумов Игорь:ыыыыы я Игорь приеду к тебе и выебу

Вы кто

куда поехали?

Значит

пошел как то мужик за пивом

А продавец ему и говорит  
  
Пива нет  
А он ему дак вот же оно в холодильнике на меня глядит игриво ПИВО ПИВО ПИВО ПИВО  

............................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................

  

Зубенко Михаил Петрович -- Мафиози  

Алия хазиахметова а что писать дальше я не знаю, и что делать дальше то?

Михалев Кирилл, съездил в Питер, классно провел время, люблю Авито и все что с этим связано.................................................................................................................

Комиссарова Юлия: люблю рисовать прикольные раскраски, читать и спать

Хайтибаев Жавохирбек: раз два три четыре пять шесть два емае

  

Русланов Усман: я обычно ложусь спать после 11 вечера. утром у меня душ и завтрак. потом я иду работать

Мне не нравятся книги жоан ролинг, она против геев. я вроде бы тоже не то чтобы за них, но и не против

Я бы голосовал за трампа, но жава, он наверно лучше байтит. хотя трамп тоже хорош

Пусть у всех все будет хорошо и мир, радость, лучи ультрафиолета

Сергей Анчутин: я сейчас веду стаблтапарим па из курорта цермат. Редактор классный.

  

ааааАнчутин Никита пишет текст чтобы провевврить чтвво теакстоаваравда ддывлаодвыадываоввваваываываывывввваааававвва

ввааааааааааааааааааыывааааыываааываввыаывыывааааавыыываываываыыывавыывввввваааваав

ававававававаававававаааввваав

  

Юля Цыбикова, пишу про себя. Все хорошо работает. О себе

Люблю кино и группу Can, особенно альбом 70-го года. С новым годом! продолжаю писать и почитываю, что там пишут остальные

  

  

  

  

  

юбая другая тема на которую можете экспромтом писать пару минут.

Аверьянов Никита

Какой-то текст, тестируем, ничего не лагает. Красиво выглядит

Продолжаю писать, все еще пишу

  

  

Кочеваткин Ростислав.  
Однажды Шрек спросил Осла.  
ОСЁЛ  
сьчл ьдчсщь чдьсьдьч сдчьсьд чьдсьчсдь дьсдчь чдсььсд чдьсььдчс дьсчдьд дчьсьсьдчьсдчь чьсдьсдсдч дьчсчьдсч чсдььчсдч чбьсдьчдсьд  

Никта Лыкосов: Как дела. Что делать. Я пишу просто какой то текст. Ты все писао обман. Что как дела что делать. Какой текст

Вот так вот

  

Антонова

Я пишу этот текст не под давлением, а потому что хочу писать тест, я очень люблю писать любой текст даже такой. хочу писать больше, можно еще больше. Мне не хватает букв, чтобы передать, как я люблю писать текст. После того как я закончу писать этот текст я пойду писать другой текст, а после него еще один текст и не успокоюсь пока не напишу все буквы в мире. Гараж тоже куплю

  

  

  

Кирилл Столбов

Всем привет, я пишу про любую тему, которая мне приходит в голову. В первую

  

Гатина Альвина Рифовна: привет! пишу этот текст, а могла бы есть вкусный ужн сейчас, вместо того, чтобы писать текст.

  

Рожков Павел: я люблю борщ и играть в футбол.

  

SOme text lorem ipsum text riba
```


[[CRDT habr статья]]